---
- hosts: localhost
  connection: local
  gather_facts: no

  tasks:
    - set_fact:
        ecr_url: "{{ lookup('env','ECR_URL') }}"
        build_id: "{{ lookup('env','BUILD_ID') }}"

    - name: Create ecs service from ecr image
      include_role:
        name: deploy_service
      vars:
        service_name: "{{ app_name }}-ci-latest"
        image: "{{ ecr_url }}/{{ app_name }}:{{ build_id }}"
        ecs_cluster_name: "{{ lookup('env','ECS_CLUSTER_NAME') }}"
